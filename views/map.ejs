<html lang="en" xml:lang="en">

<head>
    <title>JourneyBook</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style type="text/css">
    #map {
        height: 77vh;
        width: 100%;
    }

    form input:focus {
        border: none;
    }

    #h3 {
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
        font-size: 35px;
        letter-spacing: 2px;
        margin-bottom: 0;
        padding-bottom: 1rem;
        text-align: center;
    }

    form {
        width: 100%;
        margin-top: 1rem;
        display: grid;
        grid-template-columns: auto auto;
        text-align: center;
        justify-content: space-around;
    }

    form input {
        border-radius: 25px;
        text-align: center;
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
        font-size: 25px;
        letter-spacing: 1px;
        width: 100%;
        margin: 0 auto;
    }

    form img {
        width: 50px;
    }

    form button {
        background: none;
        border: none;
        margin: 0;
        padding: 0;
        cursor: pointer;
        width: max-content;
    }
    </style>
    <script src="https://apis.mapmyindia.com/advancedmaps/v1/33OkryzDZsJICBiHWE71Wz1LSEHDZ5RwgDIcXSLSfZrvfYERR5j0qnvAb_oysRGnVtmKu0styf66OWSBaHsPJQ==/map_load?v=1.5">
    </script>
</head>

<body>
    <div id="h3">JourneyBook</div>
    <div id="map"></div>
    <form method="POST" action="/add">
        <input type="info" id="info" name="info" placeholder="info" required />
        <button onclick="getLocation()" name="button" id="button" value="">
            <img src="https://user-images.githubusercontent.com/85221003/134800277-af1b7ef5-b49d-432e-9a2c-0d2b1ba9196b.gif" alt="+">
        </button>
    </form>
    <script>
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPostion);

        } else {
            document.getElementById("h3").innerHTML = "GeoLocation is not supported on your browser";
        }
    }

    function showPostion(position) {
        var location = [position.coords.latitude,  position.coords.longitude];
        document.getElementById("h3").innerHTML = "Latitude : " + location[0] + " and Longitude : " + position.coords.longitude;
        document.getElementById("button").value = location;
        console.log(location);
    }

    var map = new MapmyIndia.Map('map', {
        center: [28.549948, 77.268241],
        zoomControl: true,
        hybrid: true
    });

    var icon1 = L.icon({
        iconUrl: 'https://user-images.githubusercontent.com/85221003/134791427-74c95d3e-60c5-4a5c-9b52-0af596673904.png',
        iconSize: [30, 30],
    });

    var icon2 = L.icon({
        iconUrl: 'https://user-images.githubusercontent.com/85221003/134791416-a15b7686-eb39-439b-b59c-62d80a7adacd.png',
        iconSize: [30, 30],
    });

    var icon3 = L.icon({
        iconUrl: 'https://user-images.githubusercontent.com/85221003/133186922-a294225c-a179-4088-ae53-a932b5d21c99.png',
        iconSize: [30, 30],
    });

    //sample points

var pts2 = [
    [28.535405, 77.258151],
    [28.534327, 77.260082],
    [28.535802, 77.258945],
    [28.535881, 77.257610]
];

var polyParam2 = {
    color: "red",
    weight: 4,
    opacity: 0.5
};
var poly2 = new L.Polyline(pts2, polyParam2);

map.addLayer(poly2);
map.fitBounds(poly2.getBounds());

L.marker(new L.LatLng(28.535405, 77.258151), {
    icon: icon1,
}).addTo(map).bindPopup('wow').openPopup();

L.marker(new L.LatLng(28.534327, 77.260082), {
    icon: icon1,
}).addTo(map).bindPopup('wow').openPopup();

L.marker(new L.LatLng(28.535802, 77.258945), {
    icon: icon1,
}).addTo(map).bindPopup('wow').openPopup();

L.marker(new L.LatLng(28.535881, 77.257610), {
    icon: icon1,
}).addTo(map).bindPopup('wow').openPopup();


<% for(var i = 0; i < user.length; i++) { if(i === id) { %>

    var pts = [];

    <% for(var j = 0; j < user[i].length; i++) { %>

    pts.push(user[i][j].lat, user[i][j].long);
    L.marker(new L.LatLng(<%= user[i][j].lat %>, <%= user[i][j].long%>), {
        icon: icon2,
    }).addTo(map).bindPopup(<%= user[i][j].info %>).openPopup();

    <% } %>

    var polyParam = {
        color: "red",
        weight: 3,
        opacity: 0.5
    };
    var poly = new L.Polyline(pts, polyParam);

    map.addLayer(poly);
    map.fitBounds(poly.getBounds());

    <% } else { %>

    <% for(var j = 0; j < user[i].length; i++) { %>

    pts.push(<%= user[i][j].lat %>, <%= user[i][j].long%>);
    L.marker(new L.LatLng(<%= user[i][j].lat %>, <%= user[i][j].long%>), {
        icon: icon1,
    }).addTo(map).bindPopup(user[i][j].info).openPopup();

    <% } %>

    var polyParam = {
        color: "blue",
        weight: 3,
        opacity: 0.5
    };
    var poly = new L.Polyline(pts, polyParam);

    map.addLayer(poly);
    map.fitBounds(poly.getBounds());

    <% } } %>
    </script>
</body>

</html>
